{% extends 'base.html' %} {% block content %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Клан</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: url("https://example.com/background.jpg") no-repeat center center fixed; /* Замените на ваш фон */
        background-size: cover;
        color: #fff;
        margin: 0;
        padding: 20px;
      }
      .clan-info {
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 20px;
      }
      h1 {
        text-align: center;
        color: #ffd700; /* Золотой цвет для заголовка */
      }
      h2 {
        color: #4caf50;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.7); /* Полупрозрачный черный фон для таблицы */
        color: #fff; /* Белый цвет текста в таблице */
      }
      th,
      td {
        border: 1px solid #fff;
        padding: 10px;
        text-align: left;
      }
      th {
        background-color: rgba(255, 215, 0, 0.2); /* Золотистый фон для заголовков */
      }
      tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.1); /* Полупрозрачный белый для четных строк */
      }
      tr:hover {
        background: rgba(255, 255, 255, 0.2); /* Эффект при наведении */
      }
      a {
        color: #f5deb3; /* Бежевый цвет для ссылок */
        text-decoration: none; /* Убираем подчеркивание */
      }
      a:hover {
        text-decoration: underline; /* Подчеркивание при наведении */
      }
    </style>
  </head>
  <body>
    <div class="clan-info">
      <h1>Клан: {{ clan_id }}</h1>
      <div id="clan-name"></div>
      <div id="clan-label"></div>
      <div id="clan-alliance"></div>
    </div>
    <h2>Игроки</h2>
    <table id="players-table">
      <thead>
        <tr>
          <th>Имя</th>
          <th>Уровень</th>
          <th>Гильдия (Карты)</th>
          <th>Гильдия (Работы)</th>
          <th>Гильдия (Охота)</th>
          <th>Ремесло (Кузнец)</th>
          <th>Ремесло (Ловец)</th>
          <th>Ремесло (Лидер)</th>
        </tr>
      </thead>
      <tbody id="players"></tbody>
    </table>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const clanId = "{{ clan_id }}"; // Получаем clan_id из шаблона

        try {
          // Запрос на получение данных о клане
          const response = await fetch(`http://127.0.0.1:8000/api/clans/?clan_id=${clanId}`);

          if (!response.ok) {
            throw new Error("Ошибка сети: " + response.statusText);
          }

          const clanData = await response.json();
          console.log(clanData); // Обработка данных о клане

          // Выводим информацию о клане на страницу
          document.getElementById("clan-name").textContent = `Название: ${clanData.data.name}`;
          document.getElementById("clan-label").innerHTML = `<img src="${clanData.data.label}" alt="Гифка клана">`;
          if (clanData.data.alliance) {
            document.getElementById("clan-alliance").innerHTML = `
                        Альянс: ${clanData.data.alliance.name} <br>
                        <img src="${clanData.data.alliance.label}" alt="Гифка альянса">
                        <a href="https://www.heroeswm.ru/clan_info.php?id=${clanData.data.alliance.id}">Подробнее</a>
                    `;
          } else {
            document.getElementById("clan-alliance").textContent = "Альянс: Нет";
          }

          // Запрос на получение игроков
          const playersResponse = await fetch(`http://127.0.0.1:8000/api/players/?clan_id=${clanId}`);

          if (!playersResponse.ok) {
            throw new Error("Ошибка сети: " + playersResponse.statusText);
          }

          const playersData = await playersResponse.json();
          console.log(playersData); // Обработка данных о игроках

          // Сортировка игроков по уровню по убыванию
          playersData.data.sort((a, b) => b.level - a.level);

          // Выводим игроков на страницу
          const playersTableBody = document.getElementById("players");
          playersData.data.forEach((player) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                        <td><a href="{% url 'player' %}?player_id=${player.id}">${player.name}</a></td>
                        <td>${player.level}</td>
                        <td>${player.gild_card}</td>
                        <td>${player.gild_work}</td>
                        <td>${player.gild_hunt}</td>
                        <td>${player.gild_blacksmith}</td>
                        <td>${player.gild_gunsmith}</td>
                        <td>${player.gild_leader}</td>
                    `;
            playersTableBody.appendChild(row);
          });
        } catch (error) {
          console.error("Ошибка при выполнении запроса:", error);
        }
      });
    </script>
  </body>
</html>
{% endblock %}
